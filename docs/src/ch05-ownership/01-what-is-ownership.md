# Ownership ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£

## ‡∏Å‡∏é 3 ‡∏Ç‡πâ‡∏≠‡∏Ç‡∏≠‡∏á Ownership

‡∏à‡∏≥‡∏Å‡∏é 3 ‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏à:

> 1. **‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏°‡∏µ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á (owner) ‡∏´‡∏ô‡∏∂‡πà‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß**
> 2. **‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏î‡∏Å‡πá‡∏ï‡∏≤‡∏° ‡∏Ñ‡πà‡∏≤‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏°‡∏µ‡πÑ‡∏î‡πâ‡πÅ‡∏Ñ‡πà‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß**
> 3. **‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å scope ‡∏Ñ‡πà‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å drop (‡∏•‡∏ö)**

> ‚ö†Ô∏è **‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢**
>
> - ‚ùå ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏á move
> - ‚ùå ‡∏™‡πà‡∏á ownership ‡πÄ‡∏Ç‡πâ‡∏≤ function ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠
> - ‚ùå ‡∏™‡∏£‡πâ‡∏≤‡∏á multiple mutable references
> - ‚úÖ ‡πÉ‡∏ä‡πâ `.clone()` ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£ copy ‡∏à‡∏£‡∏¥‡∏á‡πÜ
> - ‚úÖ ‡πÉ‡∏ä‡πâ references (`&`) ‡πÅ‡∏ó‡∏ô move ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÑ‡∏°‡πà‡∏à‡∏≥‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÇ‡∏≠‡∏ô ownership

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô

```rust,ignore
fn main() {
    {
        let s = String::from("hello"); // s ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô ‡πÄ‡∏õ‡πá‡∏ô owner ‡∏Ç‡∏≠‡∏á "hello"

        println!("{}", s); // ‡πÉ‡∏ä‡πâ s ‡πÑ‡∏î‡πâ

    } // s ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å scope -> memory ‡∏ñ‡∏π‡∏Å free ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥

    // println!("{}", s); // ‚ùå Error! s ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß
}
```

---

## Stack vs Heap

‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Ownership ‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à Stack ‡πÅ‡∏•‡∏∞ Heap ‡∏Å‡πà‡∏≠‡∏ô:

### Stack

- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
- ‡πÄ‡∏£‡πá‡∏ß‡∏°‡∏≤‡∏Å
- LIFO (Last In, First Out)
- ‡πÄ‡∏ä‡πà‡∏ô: `i32`, `f64`, `bool`, `char`

### Heap

- ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÑ‡∏°‡πà‡∏Ñ‡∏á‡∏ó‡∏µ‡πà
- ‡∏ä‡πâ‡∏≤‡∏Å‡∏ß‡πà‡∏≤ Stack
- ‡∏ï‡πâ‡∏≠‡∏á allocate ‡πÅ‡∏•‡∏∞ deallocate
- ‡πÄ‡∏ä‡πà‡∏ô: `String`, `Vec<T>`

```text
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     Stack       ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ ptr  ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ len = 5       ‚îÇ ‚îÇ      ‚îÇ     Heap      ‚îÇ
‚îÇ capacity = 5  ‚îÇ ‚îÇ      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îò      ‚îÇ h e l l o     ‚îÇ
                ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ               ‚îÇ
                         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## Copy Types vs Move Types

### Copy Types (‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Stack)

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ñ‡∏π‡∏Å **copy** ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:

```rust,ignore
fn main() {
    let x = 5;
    let y = x; // copy ‡∏Ñ‡πà‡∏≤

    println!("x = {}, y = {}", x, y); // ‚úÖ ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ
}
```

| Copy Types                       |
| -------------------------------- |
| i32, u32, i64, etc.              |
| f32, f64                         |
| bool                             |
| char                             |
| Tuples ‡∏ó‡∏µ‡πà‡∏°‡∏µ Copy types ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô |

### Move Types (‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô Heap)

‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô Heap ‡∏ñ‡∏π‡∏Å **move**:

```rust,ignore
fn main() {
    let s1 = String::from("hello");
    let s2 = s1; // s1 ‡∏ñ‡∏π‡∏Å MOVE ‡πÑ‡∏õ s2

    // println!("{}", s1); // ‚ùå Error! s1 ‡∏ñ‡∏π‡∏Å move ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
    println!("{}", s2); // ‚úÖ OK
}
```

---

## ‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á Move?

‡∏ñ‡πâ‡∏≤ Rust copy ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏ô Heap ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞ move:

```text
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
s1 ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   hello     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ s2 (‡∏ñ‡πâ‡∏≤ copy)
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

‡πÄ‡∏°‡∏∑‡πà‡∏≠ s1 ‡πÅ‡∏•‡∏∞ s2 ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å scope
‚Üí ‡∏ó‡∏±‡πâ‡∏á‡∏™‡∏≠‡∏á‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏° free memory ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô
‚Üí DOUBLE FREE! üí•
```

Rust ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÇ‡∏î‡∏¢‡∏ó‡∏≥‡πÉ‡∏´‡πâ `s1` ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏±‡∏á move

---

## Ownership ‡πÅ‡∏•‡∏∞ Functions

### ‡∏™‡πà‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤ function = Move

```rust,ignore
fn main() {
    let s = String::from("hello");

    takes_ownership(s); // s ‡∏ñ‡∏π‡∏Å move ‡πÄ‡∏Ç‡πâ‡∏≤ function

    // println!("{}", s); // ‚ùå Error! s ‡∏ñ‡∏π‡∏Å move ‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß
}

fn takes_ownership(some_string: String) {
    println!("{}", some_string);
} // some_string ‡∏ñ‡∏π‡∏Å drop ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
```

### Return = ‡∏¢‡πâ‡∏≤‡∏¢ ownership ‡∏Å‡∏•‡∏±‡∏ö

```rust,ignore
fn main() {
    let s1 = gives_ownership(); // s1 ‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö ownership

    println!("{}", s1); // ‚úÖ OK
}

fn gives_ownership() -> String {
    let s = String::from("hello");
    s // return ‡πÅ‡∏•‡∏∞ move ownership
}
```

---

## ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: ‡∏™‡πà‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏•‡∏±‡∏ö

```rust,ignore
fn main() {
    let s1 = String::from("hello");

    let (s2, len) = calculate_length(s1);

    println!("The length of '{}' is {}.", s2, len);
}

fn calculate_length(s: String) -> (String, usize) {
    let length = s.len();
    (s, length) // return tuple
}
```

> **‡∏õ‡∏±‡∏ç‡∏´‡∏≤:** ‡∏ï‡πâ‡∏≠‡∏á return ‡∏Ñ‡πà‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠ ‡∏¢‡∏∏‡πà‡∏á‡∏¢‡∏≤‡∏Å‡∏°‡∏≤‡∏Å!
>
> **‡∏ó‡∏≤‡∏á‡∏≠‡∏≠‡∏Å:** ‡πÉ‡∏ä‡πâ References (‡∏ö‡∏ó‡∏ñ‡∏±‡∏î‡πÑ‡∏õ)

---

## Scope ‡πÅ‡∏•‡∏∞ Drop

```rust,ignore
fn main() {
    let outer = String::from("outer");

    {
        let inner = String::from("inner");
        println!("{}", inner); // ‚úÖ OK
    } // inner ‡∏ñ‡∏π‡∏Å drop ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

    // println!("{}", inner); // ‚ùå inner ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß

    println!("{}", outer); // ‚úÖ OK
} // outer ‡∏ñ‡∏π‡∏Å drop ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
```

---

## ‡∏•‡∏≠‡∏á‡∏ó‡∏≥‡∏î‡∏π! üéØ

1. ‡∏•‡∏≠‡∏á‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà move String ‡πÅ‡∏•‡∏∞‡∏î‡∏π error
2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ `.clone()`
3. ‡∏•‡∏≠‡∏á‡∏™‡πà‡∏á String ‡πÄ‡∏Ç‡πâ‡∏≤ function ‡πÅ‡∏•‡∏∞‡∏î‡∏π‡∏ß‡πà‡∏≤‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏∞‡πÑ‡∏£

---

## ‡∏™‡∏£‡∏∏‡∏õ

| ‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏¥‡∏î | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢                    |
| ------ | --------------------------- |
| Owner  | ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ó‡∏µ‡πà "‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á" ‡∏Ñ‡πà‡∏≤ |
| Move   | ‡∏¢‡πâ‡∏≤‡∏¢ ownership              |
| Drop   | ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å scope   |
| Stack  | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å copy ‡πÑ‡∏î‡πâ     |
| Heap   | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà‡∏ï‡πâ‡∏≠‡∏á move     |

üëâ ‡∏ï‡πà‡∏≠‡πÑ‡∏õ: [Move & Clone](./02-move-clone.md)
