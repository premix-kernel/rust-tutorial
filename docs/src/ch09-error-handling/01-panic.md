# panic! - Unrecoverable Errors

`panic!` à¸«à¸¢à¸¸à¸”à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸—à¸±à¸™à¸—à¸µà¹€à¸¡à¸·à¹ˆà¸­à¹€à¸à¸´à¸” error à¸—à¸µà¹ˆà¸ˆà¸±à¸”à¸à¸²à¸£à¹„à¸¡à¹ˆà¹„à¸”à¹‰

### ğŸš¨ Error Handling Decision Tree

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Error Handling in Rust                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                       â”‚
â”‚                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                      â”‚ à¹€à¸à¸´à¸” Error!  â”‚                                â”‚
â”‚                      â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                             â”‚                                        â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚           â”‚                                   â”‚                     â”‚
â”‚           â–¼                                   â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ Recoverable?  â”‚                   â”‚ Unrecoverable â”‚             â”‚
â”‚   â”‚ à¸à¸¹à¹‰à¸„à¸·à¸™à¹„à¸”à¹‰     â”‚                   â”‚ à¸à¸¹à¹‰à¸„à¸·à¸™à¹„à¸¡à¹ˆà¹„à¸”à¹‰  â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚           â”‚                                   â”‚                     â”‚
â”‚           â–¼                                   â–¼                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚   â”‚ Result<T, E>  â”‚                   â”‚   panic!()    â”‚             â”‚
â”‚   â”‚               â”‚                   â”‚               â”‚             â”‚
â”‚   â”‚ â€¢ File not    â”‚                   â”‚ â€¢ Bug in code â”‚             â”‚
â”‚   â”‚   found       â”‚                   â”‚ â€¢ Impossible  â”‚             â”‚
â”‚   â”‚ â€¢ Parse error â”‚                   â”‚   state       â”‚             â”‚
â”‚   â”‚ â€¢ Network     â”‚                   â”‚ â€¢ Contract    â”‚             â”‚
â”‚   â”‚   timeout     â”‚                   â”‚   violation   â”‚             â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆà¹€à¸à¸´à¸” Panic?

### 1. à¹€à¸£à¸µà¸¢à¸ panic! à¹€à¸­à¸‡

```rust,should_panic
fn main() {
    panic!("crash and burn");
}
```

Output:

```text
thread 'main' panicked at 'crash and burn', src/main.rs:2:5
```

### 2. Bug à¹ƒà¸™à¹‚à¸„à¹‰à¸”

```rust,should_panic
fn main() {
    let v = vec![1, 2, 3];
    v[99]; // ğŸ’¥ panic! index out of bounds
}
```

---

## Backtrace

à¸”à¸¹ backtrace à¹€à¸à¸·à¹ˆà¸­à¸«à¸²à¸—à¸µà¹ˆà¸¡à¸²à¸‚à¸­à¸‡ panic:

```bash
RUST_BACKTRACE=1 cargo run
```text

```text
thread 'main' panicked at 'index out of bounds: the len is 3 but the index is 99'
stack backtrace:
   0: std::panicking::begin_panic_handler
   1: core::panicking::panic_bounds_check
   2: <usize as core::slice::SliceIndex<[T]>>::index
   3: playground::main
             at src/main.rs:3:5
```

---

## à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸«à¸£à¹ˆà¸„à¸§à¸£à¹ƒà¸Šà¹‰ panic!

### âœ… à¸„à¸§à¸£à¹ƒà¸Šà¹‰

1. **Prototyping** - à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¹‚à¸„à¹‰à¸”, à¸—à¸”à¸¥à¸­à¸‡

```rust,should_panic
fn main() {
    // à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ implement
    todo!("implement this later");
}
```

2. **Tests** - à¹€à¸¡à¸·à¹ˆà¸­ test fail

```rust,ignore
#[test]
fn test_something() {
    assert_eq!(1, 2); // panic! à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¹€à¸—à¹ˆà¸²
}
```

3. **Unrecoverable situation** - à¸ªà¸–à¸²à¸™à¸à¸²à¸£à¸“à¹Œà¸—à¸µà¹ˆà¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸•à¹‰à¸­à¸‡à¸«à¸¢à¸¸à¸”

```rust
fn divide(a: i32, b: i32) -> i32 {
    if b == 0 {
        panic!("Cannot divide by zero!");
    }
    a / b
}
```

4. **Invalid state** - à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸­à¸¢à¸¹à¹ˆà¹ƒà¸™à¸ªà¸–à¸²à¸™à¸°à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡

```rust
fn process_age(age: i32) {
    if age < 0 || age > 150 {
        panic!("Invalid age: {}", age);
    }
    // ...
}
```

### âŒ à¹„à¸¡à¹ˆà¸„à¸§à¸£à¹ƒà¸Šà¹‰

1. **Expected failures** - à¹€à¸Šà¹ˆà¸™ file not found, network error
2. **User input errors** - à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸à¸´à¸¡à¸à¹Œà¸œà¸´à¸”
3. **Recoverable errors** - à¸¥à¸­à¸‡ retry à¹„à¸”à¹‰

> **Rule of thumb:** à¸–à¹‰à¸²à¸œà¸¹à¹‰à¹€à¸£à¸µà¸¢à¸à¸ªà¸²à¸¡à¸²à¸£à¸– handle error à¹„à¸”à¹‰ â†’ à¹ƒà¸Šà¹‰ `Result`

> ğŸ’¡ **Best Practices: panic! vs Result**
>
> ```text
> â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
> â”‚                  à¹€à¸¥à¸·à¸­à¸ Error Handling                   â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚  panic!           â”‚  Result<T, E>                       â”‚
> â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
> â”‚  âœ“ Bug à¹ƒà¸™à¹‚à¸„à¹‰à¸”     â”‚  âœ“ File not found                   â”‚
> â”‚  âœ“ Invalid state  â”‚  âœ“ Network error                    â”‚
> â”‚  âœ“ Tests          â”‚  âœ“ User input error                 â”‚
> â”‚  âœ“ Prototyping    â”‚  âœ“ Parse error                      â”‚
> â”‚  âœ“ Unrecoverable  â”‚  âœ“ Recoverable errors               â”‚
> â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
> ```

---

## unwrap à¹à¸¥à¸° expect

### unwrap

```rust
fn main() {
    let x: Option<i32> = Some(5);
    let value = x.unwrap(); // âœ… 5

    let y: Option<i32> = None;
    // let value = y.unwrap(); // ğŸ’¥ panic!
}
```

### expect (à¸”à¸µà¸à¸§à¹ˆà¸² unwrap)

```rust,should_panic
fn main() {
    let x: Option<i32> = None;

    // à¹ƒà¸«à¹‰ error message à¸—à¸µà¹ˆà¸Šà¸±à¸”à¹€à¸ˆà¸™
    let value = x.expect("x should have a value");
}
```

Output:

```text
thread 'main' panicked at 'x should have a value', src/main.rs:4:18
```

---

## unreachable! à¹à¸¥à¸° todo!

```rust,should_panic
fn main() {
    let level = 5;

    let description = match level {
        1..=5 => "beginner",
        6..=10 => "intermediate",
        11..=20 => "advanced",
        _ => unreachable!("level should be 1-20"),
    };

    // à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ implement
    todo!("add more logic here");
}
```

---

## à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡à¸ˆà¸£à¸´à¸‡: Assertion

```rust,should_panic
fn set_age(age: u32) {
    assert!(age <= 150, "Age {} is unrealistic", age);
    println!("Age set to {}", age);
}

fn main() {
    set_age(25);  // âœ… OK
    set_age(200); // ğŸ’¥ panic!
}
```

---

## à¸¥à¸­à¸‡à¸—à¸³à¸”à¸¹! ğŸ¯

1. à¸ªà¸£à¹‰à¸²à¸‡ function à¸—à¸µà¹ˆ panic à¹€à¸¡à¸·à¹ˆà¸­à¹„à¸”à¹‰à¸£à¸±à¸šà¸„à¹ˆà¸²à¸¥à¸š
2. à¹ƒà¸Šà¹‰ expect à¹à¸—à¸™ unwrap à¹à¸¥à¸°à¹ƒà¸«à¹‰ error message à¸—à¸µà¹ˆà¸”à¸µ
3. à¸¥à¸­à¸‡à¹€à¸›à¸´à¸” RUST_BACKTRACE=1 à¸”à¸¹ backtrace

---

## à¸ªà¸£à¸¸à¸›

| Macro            | à¹ƒà¸Šà¹‰à¹€à¸¡à¸·à¹ˆà¸­              |
| ---------------- | --------------------- |
| `panic!("msg")`  | Error à¸£à¹‰à¸²à¸¢à¹à¸£à¸‡         |
| `unreachable!()` | à¹‚à¸„à¹‰à¸”à¸—à¸µà¹ˆà¹„à¸¡à¹ˆà¸„à¸§à¸£à¸–à¸¹à¸à¹€à¸£à¸µà¸¢à¸ |
| `todo!()`        | à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¹„à¸”à¹‰ implement   |
| `assert!(cond)`  | à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚       |

ğŸ‘‰ à¸•à¹ˆà¸­à¹„à¸›: [Result<T, E>](./02-result.md)
